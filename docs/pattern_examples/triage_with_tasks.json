{
  "workflow_name": "Triage with Tasks",
  "pattern_id": 9,
  "pattern_name": "Triage with Tasks",
  "trigger": "chat",
  "initiated_by": "user",
  "human_in_loop": true,
  "modules": [
    {
      "module_index": 0,
      "module_name": "Decompose and Execute Tasks",
      "module_description": "Classify the request into ordered research and build tasks, enforce dependencies, and summarize results.",
      "pattern_id": 9,
      "pattern_name": "Triage with Tasks",
      "context_variables": [
        {
          "name": "research_tasks",
          "type": "collection",
          "description": "List of research tasks with status and outputs."
        },
        {
          "name": "build_tasks",
          "type": "collection",
          "description": "List of build/write tasks gated on research completion."
        },
        {
          "name": "current_research_task_index",
          "type": "index",
          "description": "Index pointer for the active research task."
        },
        {
          "name": "current_build_task_index",
          "type": "index",
          "description": "Index pointer for the active build task."
        }
      ],
      "agents": [
        {
          "agent_name": "TriageAgent",
          "agent_type": "intake",
          "objective": "Breaks the request into research and build tasks with priorities and acceptance criteria.",
          "generation_mode": null,
          "agent_tools": [
            {
              "name": "capture_task_intent",
              "integration": null,
              "purpose": "Inline capture of desired outcomes and constraints.",
              "interaction_mode": "inline"
            }
          ],
          "lifecycle_tools": [],
          "system_hooks": [],
          "human_interaction": "context",
          "max_consecutive_auto_reply": 20
        },
        {
          "agent_name": "TaskManagerAgent",
          "agent_type": "router",
          "objective": "Initializes task queues, enforces sequencing, and routes to the right worker.",
          "generation_mode": null,
          "agent_tools": [
            {
              "name": "initiate_tasks",
              "integration": "OpenAI",
              "purpose": "Generate ordered task queues and update status flags.",
              "interaction_mode": "none"
            }
          ],
          "lifecycle_tools": [],
          "system_hooks": [],
          "human_interaction": "none",
          "max_consecutive_auto_reply": 30
        },
        {
          "agent_name": "ResearchAgent",
          "agent_type": "worker",
          "objective": "Completes research tasks and updates progress before build tasks begin.",
          "generation_mode": null,
          "agent_tools": [
            {
              "name": "complete_research_task",
              "integration": "OpenAI",
              "purpose": "Return findings for the current research task.",
              "interaction_mode": "none"
            }
          ],
          "lifecycle_tools": [],
          "system_hooks": [],
          "human_interaction": "none",
          "max_consecutive_auto_reply": 30
        },
        {
          "agent_name": "BuildAgent",
          "agent_type": "worker",
          "objective": "Executes build/write tasks after research is done.",
          "generation_mode": null,
          "agent_tools": [
            {
              "name": "complete_build_task",
              "integration": "OpenAI",
              "purpose": "Deliver the build/write output for the active task.",
              "interaction_mode": "none"
            }
          ],
          "lifecycle_tools": [],
          "system_hooks": [],
          "human_interaction": "none",
          "max_consecutive_auto_reply": 30
        },
        {
          "agent_name": "SummaryAgent",
          "agent_type": "evaluator",
          "objective": "Summarizes all completed tasks and delivers final output to the user.",
          "generation_mode": null,
          "agent_tools": [
            {
              "name": "present_summary",
              "integration": null,
              "purpose": "Artifact summary for user approval and edits.",
              "interaction_mode": "artifact"
            }
          ],
          "lifecycle_tools": [],
          "system_hooks": [],
          "human_interaction": "approval",
          "max_consecutive_auto_reply": 5
        }
      ],
      "handoffs": [
        {
          "from": "TriageAgent",
          "to": "TaskManagerAgent",
          "condition": "research_tasks is not None and build_tasks is not None",
          "type": "OnContextCondition"
        },
        {
          "from": "TaskManagerAgent",
          "to": "ResearchAgent",
          "condition": "current_research_task_index >= 0",
          "type": "OnContextCondition"
        },
        {
          "from": "ResearchAgent",
          "to": "TaskManagerAgent",
          "condition": "True",
          "type": "OnContextCondition"
        },
        {
          "from": "TaskManagerAgent",
          "to": "BuildAgent",
          "condition": "current_research_task_index == -1 and current_build_task_index >= 0",
          "type": "OnContextCondition"
        },
        {
          "from": "BuildAgent",
          "to": "TaskManagerAgent",
          "condition": "True",
          "type": "OnContextCondition"
        },
        {
          "from": "TaskManagerAgent",
          "to": "SummaryAgent",
          "condition": "current_build_task_index == -1",
          "type": "OnContextCondition"
        }
      ],
      "tools": [
        {
          "agent": "TriageAgent",
          "function": "capture_task_intent",
          "file": "capture_task_intent.py",
          "description": "Inline capture of goals and constraints before tasking.",
          "tool_type": "UI_Tool",
          "auto_invoke": true,
          "ui": {
            "component": "TaskIntentForm",
            "mode": "inline",
            "ui_pattern": "multi_step"
          },
          "integration": null
        },
        {
          "agent": "SummaryAgent",
          "function": "present_summary",
          "file": "present_summary.py",
          "description": "Artifact summary for user approval and edits.",
          "tool_type": "UI_Tool",
          "auto_invoke": true,
          "ui": {
            "component": "SummaryCard",
            "mode": "artifact",
            "ui_pattern": "two_step_confirmation"
          },
          "integration": null
        }
      ],
      "hooks": {
        "before_chat": null,
        "after_chat": null,
        "agent_hooks": []
      },
      "orchestrator": {
        "type": "DefaultPattern",
        "config": {
          "start_agent": "TriageAgent"
        }
      }
    }
  ]
}
