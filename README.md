# MozaiksAI - Event-Driven AI Workflow Orchestration

MozaiksAI is a sophisticated, event-driven platform for building, orchestrating, and managing complex AI agent workflows. Built on top of Microsoft's Autogen (AG2), it provides a robust framework for creating production-grade, multi-agent systems with real-time persistence, seamless chat resumption, and comprehensive observability.

Our architecture is designed around a "strategically lean" philosophy, ensuring that every component is efficient, scalable, and serves a clear purpose.

## Key Architectural Pillars

1.  **Event-Driven Core**: At the heart of MozaiksAI is a powerful event bus. Every actionâ€”from an agent sending a message to token usage being calculatedâ€”is an event. This allows for decoupled components, real-time data processing, and extreme flexibility.
2.  **Centralized Event Processing**: All events generated by the AG2 engine flow through a single `UIEventProcessor`. This central hub is responsible for delegating tasks like data persistence, UI updates, and logging, ensuring a single, predictable path for all system events.
3.  **Real-Time Persistence**: We've eliminated batch processing. The `AG2PersistenceManager` listens to the event stream and saves every message, token count, and cost metric to our MongoDB database the moment it occurs. This enables live dashboards, accurate cost tracking, and flawless chat session resumption.
4.  **Modular & Composable Workflows**: Workflows, agents, and tools are defined in simple YAML files, allowing for rapid development and easy modification without changing core application code. This "configuration-as-code" approach makes the system highly adaptable.

## Features

-   **Seamless Chat Resumption**: Never lose context. Any chat session can be picked up exactly where it left off, with the full message history loaded instantly.
-   **Live Performance Tracking**: Monitor token usage and costs in real-time as agents work, not after the fact.
-   **Dynamic UI**: The frontend is driven by events, allowing for rich, real-time user experiences that reflect the agent's activities.
-   **Modular Tooling**: Easily add new tools and capabilities to your agents. Our tool registry system makes it simple to extend agent functionality.
-   **Production-Ready**: With built-in logging, error handling, and a scalable architecture, MozaiksAI is designed for real-world deployment.

## Getting Started

### Prerequisites

-   Python 3.10+
-   MongoDB instance
-   Node.js and npm (for the ChatUI)
-   An OpenAI API key (or other compatible LLM provider)

### Installation

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/BlocUnited-LLC/MozaiksAI.git
    cd MozaiksAI
    ```

2.  **Install Python dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

3.  **Configure Environment Variables:**
    Create a `.env` file in the root directory and add your configuration, including your MongoDB connection string and LLM API keys.

4.  **Run the ChatUI:**
    ```bash
    cd ChatUI
    npm install
    npm start
    ```

5.  **Run the Backend Server:**
    In the root directory, run:
    ```bash
    python run_server.py
    ```

### Run with Docker (optional)

You can run the backend and an OpenTelemetry Collector via Docker Compose:

```powershell
# From repo root (Windows PowerShell)
docker compose -f infra/compose/docker-compose.yml up --build
```

Notes:
- Dockerfile is at `infra/docker/Dockerfile`.
- Collector config is at `infra/otel/otel-collector-config.yaml` and exports to console logs by default.
- Set `OPENLIT_ENABLED=true` to emit OTEL telemetry; otherwise the app runs without telemetry.

## Documentation

For a deeper dive into the architecture, please see the following documents:

-   `ARCHITECTURE.md`: A detailed overview of the system's design.
-   `EVENT_FLOW.md`: An explanation of how events move through the system.
-   `PERSISTENCE.md`: Details on the database schema and persistence logic.

#### 5. ğŸ”” Event Architecture
- Unified Event Dispatcher (`core/events/unified_event_dispatcher.py`) centralizes event routing for Business, Runtime, and UI Tool events.
- Events are defined by dataclasses (`BusinessLogEvent`, `RuntimeEvent`, `UIToolEvent`) and processed by default handlers (`BusinessLogHandler`, `RuntimeEventHandler`, `UIToolHandler`).
- Dispatcher metrics track processed, failed, and categorized events.
- Emit events via convenience methods: `emit_business_event()`, `emit_runtime_event()`, `emit_ui_tool_event()`.

```mermaid
sequenceDiagram
    participant Producer as Code/Agent
    participant Dispatcher as UnifiedEventDispatcher
    participant Handler as EventHandler
    participant Persistence as Persistence/Transport
    Producer->>Dispatcher: emit_*_event(...)
    Dispatcher->>Handler: handle(event)
    Handler->>Persistence: log/process
```

---

## ğŸ§© Key Features

### Dynamic Agent-UI Integration
- **Real-Time Component Control:** Agents can dynamically render, update, and control React components based on conversation context
- **Bidirectional Communication:** UI components can trigger backend handlers, creating interactive workflows
- **Context Variable Synchronization:** Seamless state sharing between agents and frontend components

### Unified Transport System
- **Protocol Flexibility:** Automatic WebSocket/SSE negotiation with graceful fallback
- **Message Filtering:** Smart filtering ensures users only see relevant agent communications
- **Event-Driven Architecture:** Six standardized event types for consistent frontend-backend communication

### Manifest-Driven Development
- **Tool Registration:** JSON-based tool manifests for dynamic agent capability extension
- **Workflow Configuration:** Complete workflow definitions in `workflow.json` with UI component integration
- **Hot-Reload Support:** Add or modify agents, tools, and components without server restart

### Enterprise-Grade Persistence
- **Conversation Continuity:** Full groupchat state persistence across server restarts
- **AG2 Resume:** Official AutoGen resume patterns for seamless conversation restoration
- **Data Isolation:** Secure enterprise and chat ID validation for multi-tenant deployments

### ğŸ“Š Real-Time Analytics & Performance Monitoring
- **Chat-Level Aggregation:** Comprehensive analytics across all workflow uses with session-by-session tracking
- **Agent Performance Metrics:** Response time analysis, token usage patterns, and efficiency monitoring
- **Live Cost Intelligence:** Real-time threshold monitoring with automated alerts and budget management
- **Workflow Optimization:** Historical performance comparison and optimization recommendations
- **Business Intelligence:** Enterprise-level insights for resource planning and cost forecasting

---

## ğŸ“‚ Project Structure

```
MozaiksAI/
â”œâ”€â”€ ğŸ“ workflows/          # Modular agent workflows and configurations
â”‚   â””â”€â”€ Generator/         # Example workflow with tool manifests
â”œâ”€â”€ ğŸ“ core/              # Core platform backend systems
â”‚   â”œâ”€â”€ transport/        # SimpleTransport and event handling
â”‚   â”œâ”€â”€ ui/              # Dynamic UI tools and artifact systems
â”‚   â”œâ”€â”€ data/            # Persistence and database management
â”‚   â””â”€â”€ workflow/        # Workflow loading and tool registry
â”œâ”€â”€ ğŸ“ ChatUI/           # React frontend application
â”‚   â”œâ”€â”€ src/components/  # Dynamic UI components
â”‚   â”œâ”€â”€ src/services/    # Transport and API integration
â”‚   â””â”€â”€ src/context/     # Frontend state management
â””â”€â”€ ğŸ“ docs/             # Technical documentation and guides
```

### Key Directories

- **`workflows/`** â€“ Self-contained agent workflows with tool manifests and UI component definitions
- **`core/`** â€“ Platform backend including transport, persistence, and workflow systems
- **`ChatUI/`** â€“ React frontend with dynamic component system and real-time transport integration  
- **`docs/`** â€“ Comprehensive technical documentation covering all system components

---

## ğŸ“– Technical Documentation

### Core System Documentation
- **[Transport & Events](docs/TRANSPORT_AND_EVENTS.md)** â€“ Unified transport system with SSE/WebSocket support and event filtering
- **[Dynamic UI System](docs/DYNAMIC_UI_SYSTEM.md)** â€“ How agents dynamically control frontend components with visual flowcharts
- **[Tool Manifest System](docs/TOOL_MANIFEST_SYSTEM.md)** â€“ JSON-based tool registration and agent capability extension
- **[Workflow Configuration](docs/WORKFLOW_CONFIG.md)** â€“ Complete workflow.json configuration with UI component integration
- **[Persistence & Resume](docs/PERSISTENCE_AND_RESUME.md)** â€“ MongoDB integration and AG2 groupchat state restoration
- **[Workflow Analytics System](docs/WORKFLOW_ANALYTICS_SYSTEM.md)** â€“ Real-time performance monitoring, cost analysis, and chat-level aggregation
- **[Token Architecture Mapping](docs/TOKEN_ARCHITECTURE_MAPPING.md)** â€“ Billing architecture integration with analytics capabilities
- **[Event Architecture](docs/EVENT_ARCHITECTURE.md)** â€“ Overview of unified event system, dispatcher, events, and handlers

### Development Guides
- **[Unified Tool and UI System](docs/UNIFIED_TOOL_AND_UI_SYSTEM.md)** â€“ How backend tools and frontend components work together through workflow.json
- **[Workflow Development Framework](docs/WORKFLOW_DEVELOPMENT_FRAMEWORK.md)** â€“ Plugin contracts, templates, and best practices for modular workflows
- **[Frontend-Backend Alignment](docs/FRONTEND_BACKEND_ALIGNMENT.md)** â€“ Ensuring seamless data flow and UI rendering between systems

### Architecture Principles
- **Modularity:** Each component is self-contained and replaceable
- **Protocol-Agnostic:** Transport layer abstracts away communication details  
- **AG2 Compatibility:** Full support for AutoGen groupchat and IOStream patterns
- **Manifest-Driven:** Tools and components registered via configuration files
- **Event-Filtered:** Only user-appropriate messages reach the frontend

---

## ğŸš€ Quick Start

### Prerequisites
- Python 3.9+ with pip
- Node.js 16+ with npm
- MongoDB (local or remote)

### Backend Setup
```bash
# Install Python dependencies
pip install -r requirements.txt

# Start the MozaiksAI backend
python run_server.py
```

### Frontend Setup
```bash
# Navigate to React frontend
cd ChatUI

# Install dependencies
npm install

# Start development server
npm start
```

### Access MozaiksAI
Visit [http://localhost:3000](http://localhost:3000) to interact with your AI agents through the dynamic UI system.

### Configuration
- **Workflow Configuration:** Edit `workflows/{workflow_name}/workflow.json` to customize agent behavior and define components
- **Transport Settings:** Configure WebSocket/SSE preferences in `core/transport/simple_transport.py`

---

## ğŸ¤ Contributing

We welcome contributions to MozaiksAI! Whether you're interested in:

- **Agent Development:** Creating new AI workflows and agent behaviors
- **UI Components:** Building dynamic React components for agent interaction  
- **Transport Enhancements:** Improving real-time communication protocols
- **Documentation:** Helping others understand and use the platform
- **Bug Fixes:** Identifying and resolving issues

### Getting Involved
1. **Fork the repository** and create a feature branch
2. **Review the documentation** in the `docs/` folder for architecture guidelines
3. **Follow the manifest-driven patterns** for adding tools and components
4. **Test your changes** with both backend and frontend systems
5. **Submit a pull request** with clear description of your contributions

For detailed development guidelines, see our [Workflow Development Framework](docs/WORKFLOW_DEVELOPMENT_FRAMEWORK.md).

---

## ğŸ† Credits

Developed with â¤ï¸ by **BlocUnited LLC** - Advancing the future of modular AI agent platforms.

Special thanks to the AutoGen (AG2) community for foundational patterns in agent orchestration and groupchat systems.

---

## ğŸ“„ License

**EXCLUSIVE LICENSE AGREEMENT**

This software is proprietary and confidential. All rights reserved by BlocUnited LLC.