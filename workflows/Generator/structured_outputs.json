{
  "structured_outputs": {
    "models": {
      "WorkflowAgent": {
        "type": "model",
        "fields": {
          "name": {
            "type": "str",
            "description": "Agent identifier (unique within the workflow)"
          },
          "description": {
            "type": "str",
            "description": "Short human-readable description of the agent's responsibilities (displayed in the UI)."
          },
          "integrations": {
            "type": "list",
            "items": "str",
            "description": "External third-party APIs/services this agent uses (PascalCase). Examples: [\"GoogleAnalytics\", \"Slack\", \"MozaiksPay\"]. Include ALL external API interactions (read/write/execute). Use [] when no external APIs are required."
          },
          "operations": {
            "type": "list",
            "items": "str",
            "description": "Workflow-internal logic this agent executes (snake_case). Examples: [\"calculate_taxes\", \"validate_email\", \"format_report\"]. Includes calculations, validations, transformations, and business logic. May touch platform DB (that's infrastructure, not third-party). Use [] when no operations apply."
          },
          "human_interaction": {
            "type": "str",
            "allowed_values": [
              "none",
              "context",
              "approval"
            ],
            "description": "Human involvement mode for THIS SPECIFIC AGENT. none = fully automated execution; context = pauses to collect user information/clarification; approval = pauses for human decision/sign-off. Set based on interaction_mode: autonomous→none only; checkpoint_approval→approval for gates; conversational→context for input collection."
          }
        }
      },
      "WorkflowPhase": {
        "type": "model",
        "fields": {
          "name": {
            "type": "str",
            "description": "Phase title (e.g., Intake, Execution, QA)"
          },
          "description": {
            "type": "str",
            "description": "Description of the phase goals and outputs. Should include Phase prefix (e.g., 'Phase 1:') and handoff clause when applicable."
          },
          "agents": {
            "type": "list",
            "items": "WorkflowAgent",
            "description": "Agents participating in this phase (at least one)."
          }
        }
      },
      "WorkflowSpec": {
        "type": "model",
        "fields": {
          "name": {
            "type": "str",
            "description": "Human-readable workflow name"
          },
          "description": {
            "type": "str",
            "description": "Paragraph-length summary (400-600 chars) explaining when the workflow triggers, what it does, and what business value it delivers. MUST follow trigger-specific patterns defined in ActionPlanArchitect instructions."
          },
          "initiated_by": {
            "type": "literal",
            "values": [
              "user",
              "system",
              "external_event"
            ],
            "description": "Who or what starts this workflow. user = human explicitly starts (form submit, button click, chat); system = platform automatically starts (cron schedule, database condition); external_event = external service triggers (webhook from third-party)."
          },
          "trigger_type": {
            "type": "literal",
            "values": [
              "form_submit",
              "chat_start",
              "cron_schedule",
              "webhook",
              "database_condition"
            ],
            "description": "Specific mechanism that initiates workflow execution. form_submit = user submits web form; chat_start = user initiates conversational session; cron_schedule = time-based trigger; webhook = external service sends HTTP POST; database_condition = internal database state meets trigger criteria."
          },
          "interaction_mode": {
            "type": "literal",
            "values": [
              "autonomous",
              "checkpoint_approval",
              "conversational"
            ],
            "description": "Human involvement pattern during execution. autonomous = fully automated, no human input during execution; checkpoint_approval = autonomous with specific human approval gates (requires_approval=true agents); conversational = multi-turn dialogue with user throughout."
          },
          "phases": {
            "type": "list",
            "items": "WorkflowPhase",
            "description": "Ordered list of phases that make up the workflow."
          }
        }
      },
      "ActionPlan": {
        "type": "model",
        "fields": {
          "workflow": {
            "type": "WorkflowSpec",
            "description": "Workflow definition produced by the ActionPlanArchitect"
          }
        }
      },
      "ActionPlanCall": {
        "type": "model",
        "fields": {
          "ActionPlan": {
            "type": "ActionPlan",
            "description": "Workflow container passed to the Action Plan UI tool (PascalCase to match tool arg)."
          },
          "agent_message": {
            "type": "str",
            "description": "Single friendly review prompt (<=140 chars)."
          }
        }
      },
      "MermaidSequenceDiagram": {
        "type": "model",
        "fields": {
          "workflow_name": {
            "type": "str",
            "description": "Workflow name this diagram represents"
          },
          "mermaid_diagram": {
            "type": "str",
            "description": "Complete Mermaid sequence diagram text, beginning with 'sequenceDiagram'. Must include required blank line after participant declarations."
          },
          "legend": {
            "type": "list",
            "items": "str",
            "description": "Optional phase legend entries (P1: Phase Name). Provide [] when no legend is required."
          }
        }
      },
      "MermaidSequenceDiagramCall": {
        "type": "model",
        "fields": {
          "MermaidSequenceDiagram": {
            "type": "MermaidSequenceDiagram",
            "description": "Diagram payload rendered after the Action Plan is approved."
          },
          "workflow": {
            "type": "WorkflowSpec",
            "description": "The action plan workflow to merge with the diagram (required for diagram enrichment)."
          },
          "agent_message": {
            "type": "str",
            "description": "Concise invitation (<=140 chars) asking the user to review the diagram."
          }
        }
      },
      "DatabaseRef": {
        "type": "model",
        "NOTE": "DEPRECATED - Kept for backwards compatibility. New context variables use definitions+agents structure with source.type discrimination.",
        "fields": {
          "database_name": {
            "type": "str",
            "description": "Name of the target database"
          },
          "collection": {
            "type": "str",
            "description": "Collection name where the variable resides"
          },
          "search_by": {
            "type": "str",
            "description": "Field used as the query key when accessing this variable"
          },
          "field": {
            "type": "str",
            "description": "Specific field in the collection that stores the variable"
          }
        }
      },
      "DatabaseVariable": {
        "type": "model",
        "fields": {
          "name": {
            "type": "str",
            "description": "Database variable name"
          },
          "description": {
            "type": "str",
            "description": "Purpose / usage in workflow"
          },
          "type": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Optional type hint for downstream consumers (e.g., string|boolean)"
          },
          "database": {
            "type": "DatabaseRef",
            "description": "Database reference information"
          }
        }
      },
      "EnvironmentVariable": {
        "type": "model",
        "fields": {
          "name": {
            "type": "str",
            "description": "Environment variable name"
          },
          "description": {
            "type": "str",
            "description": "Purpose / usage in workflow"
          },
          "type": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Optional type hint (boolean|integer|string)"
          },
          "env_var": {
            "type": "str",
            "description": "Underlying environment variable key"
          },
          "default": {
            "type": "union",
            "variants": [
              "null",
              "str",
              "bool",
              "int"
            ],
            "description": "Fallback value when the environment variable is not set"
          }
        }
      },
      "DeclarativeVariable": {
        "type": "model",
        "fields": {
          "name": {
            "type": "str",
            "description": "Declarative variable name"
          },
          "description": {
            "type": "str",
            "description": "Purpose / usage in workflow"
          },
          "type": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Optional type hint (string|boolean|integer|dict)"
          },
          "value": {
            "type": "union",
            "variants": [
              "str",
              "bool",
              "int",
              "float",
              "dict"
            ],
            "description": "Literal value injected into context"
          }
        }
      },
      "DerivedTriggerMatch": {
        "type": "model",
        "fields": {
          "equals": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Exact string match required for the trigger (agent_text only)."
          },
          "contains": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Substring match evaluated against emitted agent text (agent_text only)."
          },
          "regex": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Regular expression applied to emitted agent text (agent_text only)."
          }
        }
      },
      "DerivedTrigger": {
        "type": "model",
        "fields": {
          "type": {
            "type": "literal",
            "values": [
              "agent_text",
              "ui_response"
            ],
            "description": "Trigger mode: agent_text (passive detection) or ui_response (active UI tool response)."
          },
          "agent": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Agent whose output is monitored (required when type=agent_text)."
          },
          "match": {
            "type": "union",
            "variants": [
              "DerivedTriggerMatch",
              "null"
            ],
            "description": "Match conditions for agent_text triggers. Must be omitted for ui_response triggers."
          },
          "tool": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Snake_case tool name responsible for updating the variable (required when type=ui_response)."
          },
          "response_key": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Key in the UI tool response payload whose value seeds the derived variable (required when type=ui_response)."
          }
        }
      },
      "DerivedVariable": {
        "type": "model",
        "fields": {
          "name": {
            "type": "str",
            "description": "Derived variable name (computed, not persisted)."
          },
          "description": {
            "type": "str",
            "description": "Purpose / effect of the derived variable. Context variables remain hidden from the frontend unless surfaced explicitly via UI tooling."
          },
          "type": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Optional type hint for downstream consumers (e.g., string|boolean|json)."
          },
          "default": {
            "type": "union",
            "variants": [
              "null",
              "str",
              "bool",
              "int",
              "float",
              "dict",
              "list"
            ],
            "description": "Initial value prior to any triggers firing."
          },
          "triggers": {
            "type": "list",
            "items": "DerivedTrigger",
            "description": "Ordered trigger definitions supporting both agent_text and ui_response contracts."
          }
        }
      },
      "ContextVariableSource": {
        "type": "model",
        "fields": {
          "type": {
            "type": "literal",
            "values": [
              "database",
              "environment",
              "static",
              "derived"
            ],
            "description": "Source classification for the context variable."
          },
          "database_name": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Mongo database name (database sources only)."
          },
          "collection": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Mongo collection name (database sources only)."
          },
          "search_by": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Field used to locate the document (database sources)."
          },
          "field": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Field extracted from the database document."
          },
          "env_var": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Environment variable name (environment sources)."
          },
          "default": {
            "type": "union",
            "variants": [
              "str",
              "int",
              "bool",
              "null"
            ],
            "description": "Fallback value when the source is unavailable."
          },
          "value": {
            "type": "union",
            "variants": [
              "str",
              "int",
              "bool",
              "null"
            ],
            "description": "Literal value for static sources."
          },
          "triggers": {
            "type": "list",
            "items": "DerivedTrigger",
            "description": "Trigger definitions for derived sources. Use [] for non-derived types.",
            "default": []
          }
        }
      },
      "ContextVariableDefinitionEntry": {
        "type": "model",
        "fields": {
          "name": {
            "type": "str",
            "description": "Unique snake_case variable name."
          },
          "type": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Canonical data type for downstream casting (string|integer|boolean etc.)."
          },
          "description": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Human readable description explaining the variable purpose."
          },
          "source": {
            "type": "ContextVariableSource",
            "description": "Source metadata describing where the value originates."
          }
        }
      },
      "ContextVariableAgentExposure": {
        "type": "model",
        "fields": {
          "agent": {
            "type": "str",
            "description": "Agent name receiving these variables."
          },
          "variables": {
            "type": "list",
            "items": "str",
            "description": "Variables exposed to the agent (empty list permitted).",
            "default": []
          }
        }
      },
      "ContextVariablesPlan": {
        "type": "model",
        "fields": {
          "definitions": {
            "type": "list",
            "items": "ContextVariableDefinitionEntry",
            "description": "Ordered list of context variable definitions (each entry includes name, type, description, and source metadata)."
          },
          "agents": {
            "type": "list",
            "items": "ContextVariableAgentExposure",
            "description": "Agent exposure entries describing which variables are visible to each agent."
          }
        }
      },
      "ContextVariablesAgentOutput": {
        "type": "model",
        "fields": {
          "ContextVariablesPlan": {
            "type": "ContextVariablesPlan",
            "description": "Complete plan with definitions dict (all variables) and agents dict (exposure mappings)."
          }
        }
      },
      "UIConfig": {
        "type": "model",
        "fields": {
          "component": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "React component name (UI_Tool only)"
          },
          "mode": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "inline or artifact (UI_Tool only)"
          }
        }
      },
      "ToolSpec": {
        "type": "model",
        "fields": {
          "agent": {
            "type": "str",
            "description": "Owning agent (or primary agent)"
          },
          "file": {
            "type": "str",
            "description": "Python module file name"
          },
          "function": {
            "type": "str",
            "description": "Async function inside the file"
          },
          "tool_type": {
            "type": "literal",
            "values": [
              "UI_Tool",
              "Agent_Tool"
            ],
            "description": "Tool type"
          },
          "ui": {
            "type": "UIConfig",
            "description": "UI metadata (nulls for Agent_Tool)"
          }
        }
      },
      "ToolsManagerAgentOutput": {
        "type": "model",
        "fields": {
          "tools": {
            "type": "list",
            "items": "ToolSpec",
            "description": "List of tool entries (mirrors tools.json format)"
          }
        }
      },
      "UIFile": {
        "type": "model",
        "fields": {
          "tool_name": {
            "type": "str",
            "description": "snake_case tool id (must match ToolsAgent manifest)"
          },
          "py_content": {
            "type": "str",
            "description": "Complete Python async stub source for the UI tool"
          },
          "js_content": {
            "type": "str",
            "description": "Complete React component stub source for the UI tool"
          }
        }
      },
      "UIFileGeneratorOutput": {
        "type": "model",
        "fields": {
          "tools": {
            "type": "list",
            "items": "UIFile",
            "description": "List of UI tools, each with Python + JS source (paths inferred downstream)"
          }
        }
      },
      "AgentTool": {
        "type": "model",
        "fields": {
          "tool_name": {
            "type": "str",
            "description": "snake_case tool id (maps to a backend/compute tool)"
          },
          "py_content": {
            "type": "str",
            "description": "Complete Python module source for this tool"
          }
        }
      },
      "AgentToolsFileGeneratorOutput": {
        "type": "model",
        "fields": {
          "tools": {
            "type": "list",
            "items": "AgentTool",
            "description": "List of backend agent tools, each with its Python source (path inferred downstream)"
          },
          "lifecycle_tools": {
            "type": "list",
            "items": "AgentTool",
            "description": "List of lifecycle hook implementations, each with its Python source. Use [] if no lifecycle tools are defined in the manifest."
          }
        }
      },
      "Hook": {
        "type": "model",
        "fields": {
          "hook_type": {
            "type": "literal",
            "values": [
              "process_message_before_send",
              "update_agent_state",
              "process_last_received_message",
              "process_all_messages_before_reply"
            ],
            "description": "Lifecycle hook type"
          },
          "hook_agent": {
            "type": "str",
            "description": "PascalCase agent name to attach hook to"
          },
          "filename": {
            "type": "str",
            "description": "File path (tools/<hook_type>.py)"
          },
          "function": {
            "type": "str",
            "description": "Function name that implements the hook"
          },
          "filecontent": {
            "type": "str",
            "description": "Hook implementation source code that includes the function defined above"
          }
        }
      },
      "HookAgentOutput": {
        "type": "model",
        "fields": {
          "hooks": {
            "type": "list",
            "items": "Hook",
            "description": "List of lifecycle hooks"
          }
        }
      },
      "AgentDefinition": {
        "type": "model",
        "fields": {
          "name": {
            "type": "str",
            "description": "Agent variable name"
          },
          "display_name": {
            "type": "str",
            "description": "Agent display name"
          },
          "system_message": {
            "type": "str",
            "description": "Complete system message for the agent"
          },
          "max_consecutive_auto_reply": {
            "type": "int",
            "default": 10
          },
          "auto_tool_mode": {
            "type": "bool",
            "description": "True when the runtime should auto-invoke UI tools for this agent (agent has at least one UI tool entry)."
          },
          "structured_outputs_required": {
            "type": "bool",
            "description": "True when the agent must produce structured outputs (Pydantic model enforced); false otherwise."
          }
        }
      },
      "AgentsAgentOutput": {
        "type": "model",
        "fields": {
          "agents": {
            "type": "list",
            "items": "AgentDefinition"
          }
        }
      },
      "OrchestratorAgentOutput": {
        "type": "model",
        "fields": {
          "workflow_name": {
            "type": "str",
            "description": "Workflow identifier"
          },
          "max_turns": {
            "type": "int",
            "description": "Maximum conversation turns"
          },
          "human_in_the_loop": {
            "type": "bool",
            "description": "Whether human interaction is required"
          },
          "startup_mode": {
            "type": "literal",
            "values": [
              "AgentDriven",
              "UserDriven",
              "BackendOnly"
            ]
          },
          "orchestration_pattern": {
            "type": "str",
            "default": "DefaultPattern"
          },
          "initial_message_to_user": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Message shown to user (UserDriven only)"
          },
          "initial_message": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Initial workflow message (AgentDriven/BackendOnly)"
          },
          "recipient": {
            "type": "str",
            "description": "First agent to receive message"
          },
          "visual_agents": {
            "type": "list",
            "items": "str",
            "description": "Agents whose messages are visible in UI"
          },
          "visual_agent": {
            "type": "list",
            "items": "str",
            "description": "Agents that can emit UI tool events"
          }
        }
      },
      "HandoffRule": {
        "type": "model",
        "fields": {
          "source_agent": {
            "type": "str",
            "description": "Source agent name"
          },
          "target_agent": {
            "type": "str",
            "description": "Target agent name or 'user' or 'terminate'"
          },
          "handoff_type": {
            "type": "literal",
            "values": [
              "condition",
              "after_work"
            ],
            "description": "Type of handoff: 'condition' for immediate evaluation (context or LLM-based), 'after_work' for post-agent-completion evaluation"
          },
          "condition": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Condition text: null for unconditional after_work, expression string with ${var} for context conditions, natural language for LLM conditions"
          },
          "condition_type": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Condition evaluation method: 'expression' for context variable expressions (${...}), 'string_llm' for LLM natural language evaluation, null to auto-detect (${} triggers expression, else LLM)"
          },
          "condition_scope": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Evaluation timing for context conditions: 'pre' for pre-reply evaluation (re-checks every turn, ideal for UI interactions), 'post' for post-reply evaluation, null for default (LLM conditions ignore this field)"
          },
          "transition_target": {
            "type": "literal",
            "values": [
              "AgentTarget",
              "RevertToUserTarget",
              "TerminateTarget"
            ],
            "description": "Type of transition target"
          }
        },
        "required": [
          "source_agent",
          "target_agent",
          "handoff_type",
          "transition_target"
        ]
      },
      "HandoffsAgentOutput": {
        "type": "model",
        "fields": {
          "handoff_rules": {
            "type": "list",
            "items": "HandoffRule"
          }
        }
      },
      "StructuredModelField": {
        "type": "model",
        "fields": {
          "name": {
            "type": "str",
            "description": "Field name"
          },
          "type": {
            "type": "str",
            "description": "Field type (str|int|bool|list|union with variants)"
          },
          "description": {
            "type": "str",
            "description": "What this field represents"
          }
        }
      },
      "StructuredModelDefinition": {
        "type": "model",
        "fields": {
          "model_name": {
            "type": "str",
            "description": "Name of the model"
          },
          "fields": {
            "type": "list",
            "items": "StructuredModelField"
          }
        }
      },
      "AgentRegistryEntry": {
        "type": "model",
        "fields": {
          "agent": {
            "type": "str",
            "description": "Agent name"
          },
          "agent_definition": {
            "type": "union",
            "variants": [
              "str",
              "null"
            ],
            "description": "Model name for this agent, or null if no structured output applies"
          }
        }
      },
      "StructuredOutputsAgentOutput": {
        "type": "model",
        "fields": {
          "models": {
            "type": "list",
            "items": "StructuredModelDefinition",
            "description": "Data models to capture"
          },
          "registry": {
            "type": "list",
            "items": "AgentRegistryEntry"
          }
        }
      }
    },
    "registry": {
      "InterviewAgent": null,
      "ActionPlanArchitect": "ActionPlanCall",
      "ProjectOverviewAgent": "MermaidSequenceDiagramCall",
      "ToolsManagerAgent": "ToolsManagerAgentOutput",
      "UIFileGenerator": "UIFileGeneratorOutput",
      "AgentToolsFileGenerator": "AgentToolsFileGeneratorOutput",
      "HookAgent": "HookAgentOutput",
      "AgentsAgent": "AgentsAgentOutput",
      "ContextVariablesAgent": "ContextVariablesAgentOutput",
      "OrchestratorAgent": "OrchestratorAgentOutput",
      "HandoffsAgent": "HandoffsAgentOutput",
      "StructuredOutputsAgent": "StructuredOutputsAgentOutput",
      "DownloadAgent": null
    }
  }
}
